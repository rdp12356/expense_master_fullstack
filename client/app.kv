#:kivy 2.3.0
#:import MDTopAppBar kivymd.uix.toolbar.MDTopAppBar
#:import MDFloatingActionButton kivymd.uix.button.MDFloatingActionButton
#:import MDNavigationLayout kivymd.uix.navigationdrawer.MDNavigationLayout
#:import MDNavigationDrawer kivymd.uix.navigationdrawer.MDNavigationDrawer
#:import Graph kivy_garden.graph.Graph
#:import dp kivy.metrics.dp

MDNavigationLayout:
    MDScreen:

        MDTopAppBar:
            id: top_bar
            title: "SuperApp"
            elevation: 2
            left_action_items: [["menu", lambda x: app.open_nav()]]
            right_action_items: [["theme-light-dark", lambda x: app.toggle_theme()]]
            pos_hint: {"top": 1}

        MDScreenManager:
            id: screen_manager
            MDScreen:
                name: "dashboard"
                MDBoxLayout:
                    orientation: "vertical"
                    spacing: "12dp"
                    padding: "12dp"
                    MDLabel:
                        text: "Dashboard"
                        halign: "left"
                        font_style: "H5"
                        size_hint_y: None
                        height: self.texture_size[1] + dp(8)
                    Graph:
                        id: chart
                        xlabel: "Tasks"
                        ylabel: "Completed"
                        x_ticks_minor: 1
                        x_ticks_major: 1
                        y_ticks_major: 1
                        y_grid_label: True
                        x_grid_label: True
                        padding: 5
                        xmin: 0
                        xmax: 10
                        ymin: 0
                        ymax: 10
                    Widget:
                        size_hint_y: 0.1

            MDScreen:
                name: "tasks"
                MDBoxLayout:
                    orientation: "vertical"
                    padding: "0dp"
                    MDTopAppBar:
                        title: "Tasks"
                        elevation: 1
                    MDScrollView:
                        MDList:
                            id: tasks_list
                MDFloatingActionButton:
                    icon: "plus"
                    md_bg_color: app.theme_cls.primary_color
                    pos: self.parent.width - self.width - dp(24), dp(24)
                    on_release: app.show_add_task_dialog()

            MDScreen:
                name: "settings"
                MDBoxLayout:
                    orientation: "vertical"
                    padding: "16dp"
                    spacing: "16dp"
                    MDToolbar:
                        title: "Settings"
                        elevation: 1
                    MDLabel:
                        text: "API Base URL"
                        halign: "left"
                        size_hint_y: None
                        height: self.texture_size[1] + dp(8)
                    MDTextField:
                        id: api_base
                        hint_text: "http://127.0.0.1:8000"
                        on_text_validate: app.save_api_base_url(self.text)
                    MDRaisedButton:
                        text: "Save"
                        on_release: app.save_api_base_url(api_base.text)

        MDNavigationDrawer:
            id: nav_drawer
            radius: (0, 16, 16, 0)
            ContentNavigationDrawer:


<ContentNavigationDrawer@MDBoxLayout>:
    orientation: "vertical"
    spacing: "8dp"
    padding: "8dp"

    MDLabel:
        text: "Navigate"
        font_style: "H6"
        size_hint_y: None
        height: self.texture_size[1]
        padding: "8dp"

    MDList:
        OneLineIconListItem:
            text: "Dashboard"
            on_release:
                app.root.ids.nav_drawer.set_state("close")
                app.root.ids.screen_manager.current = "dashboard"
        OneLineIconListItem:
            text: "Tasks"
            on_release:
                app.root.ids.nav_drawer.set_state("close")
                app.root.ids.screen_manager.current = "tasks"
        OneLineIconListItem:
            text: "Settings"
            on_release:
                app.root.ids.nav_drawer.set_state("close")
                app.root.ids.screen_manager.current = "settings"